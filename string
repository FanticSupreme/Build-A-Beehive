local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

-- GUI Setup
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")
local ScreenGui = Instance.new("ScreenGui", PlayerGui)
ScreenGui.Name = "HoneyUI"
ScreenGui.ResetOnSpawn = false

-- Main Frame (Draggable + Minimizable)
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 220, 0, 200)
frame.Position = UDim2.new(0, 20, 0, 100)
frame.BackgroundColor3 = Color3.fromRGB(240, 240, 240)
frame.Active = true
frame.Draggable = true
frame.Parent = ScreenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 30)
title.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
title.Text = "🐝 Auto Honey Farm"
title.Font = Enum.Font.SourceSansBold
title.TextSize = 20
title.TextColor3 = Color3.new(0, 0, 0)
title.Parent = frame

-- Minimize Button
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0, 30, 0, 30)
minimizeBtn.Position = UDim2.new(1, -30, 0, 0)
minimizeBtn.Text = "-"
minimizeBtn.Font = Enum.Font.SourceSansBold
minimizeBtn.TextSize = 20
minimizeBtn.TextColor3 = Color3.new(0, 0, 0)
minimizeBtn.Parent = frame

-- Buttons
local function makeButton(text, posY)
	local btn = Instance.new("TextButton")
	btn.Size = UDim2.new(0.9, 0, 0, 40)
	btn.Position = UDim2.new(0.05, 0, 0, posY)
	btn.BackgroundColor3 = Color3.fromRGB(255, 221, 85)
	btn.Text = text
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 20
	btn.TextColor3 = Color3.new(0, 0, 0)
	btn.Parent = frame
	return btn
end

local autoFarmBtn = makeButton("▶️ Start Auto Farm", 40)
local sellNowBtn = makeButton("💰 Sell Honey Now", 90)
local toggleAutoSellBtn = makeButton("🔁 Auto-Sell: OFF", 140)

-- States
local autoFarming = false
local autoSelling = false

-- 🔁 Auto Farm Loop (all hives 1-100)
local function autoFarmLoop()
	local hiveFolder = workspace:WaitForChild("Plots"):WaitForChild("Model"):WaitForChild("Hives")
	local extractRemote = ReplicatedStorage:WaitForChild("Framework")
		:WaitForChild("Features")
		:WaitForChild("HoneySystem")
		:WaitForChild("HiveUtil")
		:WaitForChild("RemoteEvent")

	local sellRemote = ReplicatedStorage:WaitForChild("Framework")
		:WaitForChild("Features")
		:WaitForChild("HoneySystem")
		:WaitForChild("HoneyUtil")
		:WaitForChild("RemoteEvent")

	while autoFarming do
		local hives = {}

		for i = 1, 100 do
			local hive = hiveFolder:FindFirstChild(tostring(i))
			if hive then table.insert(hives, hive) end
		end

		if #hives > 0 then
			extractRemote:FireServer("ExtractHoney", hives)
			print("🍯 Extracted from", #hives, "hives")
		end

		if autoSelling then
			sellRemote:FireServer("SellHoney")
			print("💰 Auto-sold honey")
		end

		wait(5)
	end
end

-- 🔘 Button Events
autoFarmBtn.MouseButton1Click:Connect(function()
	autoFarming = not autoFarming
	if autoFarming then
		autoFarmBtn.Text = "⏹ Stop Auto Farm"
		task.spawn(autoFarmLoop)
	else
		autoFarmBtn.Text = "▶️ Start Auto Farm"
	end
end)

sellNowBtn.MouseButton1Click:Connect(function()
	local sellRemote = ReplicatedStorage:WaitForChild("Framework")
		:WaitForChild("Features")
		:WaitForChild("HoneySystem")
		:WaitForChild("HoneyUtil")
		:WaitForChild("RemoteEvent")
	sellRemote:FireServer("SellHoney")
	print("💰 Manual sell")
end)

toggleAutoSellBtn.MouseButton1Click:Connect(function()
	autoSelling = not autoSelling
	toggleAutoSellBtn.Text = autoSelling and "🔁 Auto-Sell: ON" or "🔁 Auto-Sell: OFF"
end)

-- ➖ Minimize toggle
local minimized = false
minimizeBtn.MouseButton1Click:Connect(function()
	minimized = not minimized
	for _, child in ipairs(frame:GetChildren()) do
		if child ~= title and child ~= minimizeBtn then
			child.Visible = not minimized
		end
	end
	minimizeBtn.Text = minimized and "+" or "-"
end)
